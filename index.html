<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Qu·∫£n l√Ω t√†i kho·∫£n</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Baloo 2', cursive;
  margin: 0;
  background: linear-gradient(135deg, #e6f7ff, #f0faff);
  min-height: 100vh;
  color: #333;
}

/* Wrap */
.wrap { max-width: 980px; margin: 30px auto; padding: 18px; position: relative; z-index: 1; }

/* Card */
.card {
  background: #fff;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.05);
  margin-bottom: 18px;
  animation: fadeIn 0.5s ease;
}
@keyframes fadeIn { 0% { opacity:0; transform:translateY(10px); } 100% { opacity:1; transform:translateY(0); } }

h1,h2,h3 { margin:0 0 12px 0; color:#007acc; }
.row { display:flex; gap:10px; flex-wrap:wrap; }
input, select { padding:10px 14px; border-radius:10px; border:2px solid #ccecff; outline:none; transition:0.2s; }
input:focus, select:focus { border-color:#66c2ff; box-shadow:0 0 6px #b3e0ff; }
button { padding:10px 16px; border-radius:20px; border:0; background:linear-gradient(45deg, #66c2ff, #99ddff); color:#fff; cursor:pointer; font-weight:500; transition:0.3s; }
button:hover { transform:scale(1.05); background:linear-gradient(45deg,#3399ff,#66ccff); }
button.ghost { background:#f0faff; border:1px solid #99ddff; color:#007acc; }

table { width:100%; border-collapse: separate; border-spacing:0 10px; margin-top:12px; }
th, td { padding:12px; background:#fff; border-radius:10px; box-shadow:0 1px 4px rgba(0,0,0,0.04); }
th { background:#e6f7ff; color:#007acc; font-size:14px; }
img.thumb { width:72px; height:72px; object-fit:cover; border-radius:10px; border:2px solid #cceeff; }
.logo { width:48px; height:48px; object-fit:cover; border-radius:50%; vertical-align:middle; margin-right:8px; border:2px solid #99ddff; }
.muted { color:#666; font-size:13px; }
.right { margin-left:auto; }

/* ===== Overlay mini ===== */
#loadingOverlay {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:9999;
  background: linear-gradient(135deg, #e6f7ff, #f0faff);
}

/* Typewriter */
#welcomeText { font-family:'Pacifico', cursive; font-size:48px; color:#007acc; margin-bottom:20px; display:flex; justify-content:center; flex-wrap:wrap; }
#welcomeText span { opacity:0; transform:translateY(-10px); animation:typeIn 0.5s forwards; }
@keyframes typeIn { to { opacity:1; transform:translateY(0); } }

/* Progress bar */
#progressWrapper { width:80%; height:24px; background:#e0f4ff; border-radius:12px; overflow:hidden; margin-top:20px; }
#progressBar { width:0%; height:100%; background:linear-gradient(90deg,#66c2ff,#99ddff); border-radius:12px; transition:0.2s; }

/* Admin select */
#adminSelect { display:none; gap:40px; justify-content:center; margin-top:20px; }
.adminBtn { width:140px; height:140px; border-radius:50%; font-size:20px; font-weight:bold; background:linear-gradient(45deg,#99ddff,#66c2ff); color:white; border:none; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.2); transition:0.3s; }
.adminBtn:hover { transform:scale(1.1); }

/* Fade overlay */
.fade-out { opacity:0 !important; pointer-events:none; transition:1s; }
</style>
</head>
<body>

<div class="wrap">

  <div class="card" id="loginCard">
    <h1>
      <img src="https://raw.githubusercontent.com/HoshinoKotaSouma/shopaccbeorin/main/download%20(3).jpeg" class="logo">
      C·ªông T√°c Vi√™n H·ªù G·ªù
    </h1>
    <h2>ƒêƒÉng nh·∫≠p</h2>
    <div class="row">
      <input id="login_username" placeholder="username" />
      <input id="login_password" placeholder="password" type="password" />
      <button id="btnLogin">ƒêƒÉng nh·∫≠p</button>
    </div>
    <p id="loginMsg" class="muted"></p>
  </div>

  <div class="card" id="appCard" style="display:none;">
    <div style="display:flex;align-items:center;">
      <h2 style="margin:0">üìã Qu·∫£n l√Ω t√†i kho·∫£n</h2>
      <div class="right muted">Role: <b id="roleLabel">-</b></div>
    </div>

    <div id="adminPanel" style="margin-top:12px;display:none;">
      <h3>‚ûï Th√™m t√†i kho·∫£n (Admin)</h3>
      <div class="row">
        <input id="new_user" placeholder="T√†i kho·∫£n (username)" />
        <input id="new_pass" placeholder="M·∫≠t kh·∫©u" />
        <input id="new_skin" placeholder="Skin" />
        <input id="new_img" placeholder="Link ·∫£nh (https://...)" />
        <select id="new_status">
          <option value="ON">ON</option>
          <option value="OFF">OFF</option>
        </select>
        <button id="btnAdd">Th√™m</button>
      </div>
    </div>

    <div style="margin-top:12px;">
      <div class="row">
        <input id="filter" placeholder="üîç T√¨m MS / username / skin..." style="flex:1" />
        <button id="btnExport" class="ghost">üìÇ Xu·∫•t CSV</button>
      </div>
    </div>

    <table id="accTable">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<div id="loadingOverlay">
  <div id="welcomeText"></div>
  <div id="progressWrapper"><div id="progressBar"></div></div>
  <div id="adminSelect">
    <button class="adminBtn" id="admin1">üå∏ Giao B√©o ‚ú®</button>
    <button class="adminBtn" id="admin2">üíô Qu·ª≥nh Cute ‚ú®</button>
  </div>
</div>

<script>
const RAW_USERS_URL = "https://raw.githubusercontent.com/HoshinoKotaSouma/ctvhogo/refs/heads/main/accounts.json";
let usersRemote = null, currentUser=null, accountsLSKey="lq_accounts_v1";

function el(id){ return document.getElementById(id); }
function show(msg){ el("loginMsg").innerText=msg||""; }

/* Load users */
async function loadRemoteUsers(){
  try{
    const res = await fetch(RAW_USERS_URL+"?_="+Date.now(), {cache:"no-store"});
    if(!res.ok) throw new Error(res.status);
    const data=await res.json(); usersRemote=data.users||null;
    return usersRemote;
  } catch(e){ usersRemote=null; show("L·ªói t·∫£i users: "+e.message); return null;}
}

/* Login */
async function doLogin(){
  const u=el("login_username").value.trim();
  const p=el("login_password").value;
  if(!u||!p){ show("Nh·∫≠p username + password"); return; }
  if(!usersRemote) await loadRemoteUsers();
  if(!usersRemote){ show("Kh√¥ng c√≥ users"); return; }
  let found=null;
  for(const k in usersRemote){
    const it=usersRemote[k];
    if(it.username===u && it.password===p){ found={username:it.username,role:it.role}; break; }
  }
  if(!found){ show("Sai username ho·∫∑c m·∫≠t kh·∫©u!"); return; }
  currentUser=found;
  el("loginCard").style.display="none";
  startOverlay();
}

/* Overlay animation */
function startOverlay(){
  const welcomeText=el("welcomeText");
  const progressBar=el("progressWrapper");
  const adminSelect=el("adminSelect");
  welcomeText.innerHTML="";
  const text="üå∏ Welcomeeee üíô ‚ú®";
  text.split("").forEach((ch,i)=>{
    const span=document.createElement("span");
    span.innerText=ch;
    span.style.animationDelay=(i*0.1)+"s";
    welcomeText.appendChild(span);
  });

  if(currentUser.role==="admin"){
    setTimeout(()=>{ adminSelect.style.display="flex"; }, text.length*100+500);
    el("admin1").onclick=el("admin2").onclick=()=>{ fadeOutOverlay(startApp); };
  } else {
    let width=0;
    const bar=el("progressBar");
    const interval=setInterval(()=>{
      width+=1; bar.style.width=width+"%";
      if(width>=100){ clearInterval(interval); fadeOutOverlay(startApp); }
    },25);
  }
}

/* Fade overlay */
function fadeOutOverlay(callback){
  const overlay=el("loadingOverlay");
  overlay.classList.add("fade-out");
  setTimeout(()=>{ overlay.style.display="none"; overlay.classList.remove("fade-out"); callback(); },1000);
}

/* Start App */
function startApp(){
  el("appCard").style.display="block";
  el("roleLabel").innerText=currentUser.role.toUpperCase();
  if(currentUser.role==="admin") el("adminPanel").style.display="block"; else el("adminPanel").style.display="none";
  renderAccounts();
}

/* ===== LocalStorage accounts ===== */
function readAccountsFromLS(){ try{ const raw=localStorage.getItem(accountsLSKey); if(!raw) return[]; return JSON.parse(raw);}catch(e){return[];} }
function writeAccountsToLS(arr){ localStorage.setItem(accountsLSKey,JSON.stringify(arr)); }
function nextMS(arr){ return String(arr.length+1).padStart(3,"0"); }

/* Add/Delete/Edit accounts */
function addAccountLocal(){
  if(!currentUser||currentUser.role!=="admin") return alert("Ch·ªâ admin ƒë∆∞·ª£c th√™m");
  const u=el("new_user").value.trim();
  const p=el("new_pass").value;
  const skin=el("new_skin").value.trim();
  const img=el("new_img").value.trim();
  const status=el("new_status").value;
  if(!u||!p){ alert("Nh·∫≠p username + password"); return; }
  const arr=readAccountsFromLS();
  arr.push({ ms:nextMS(arr), username:u, password:p, skin:skin, image:img, status:status });
  writeAccountsToLS(arr); renderAccounts();
  el("new_user").value=""; el("new_pass").value=""; el("new_skin").value=""; el("new_img").value="";
}
function deleteAccountLocal(idx){ if(!currentUser||currentUser.role!=="admin") return; if(!confirm("X√≥a acc MS "+String(idx+1).padStart(3,"0")+" ?")) return; const arr=readAccountsFromLS(); arr.splice(idx,1); for(let i=0;i<arr.length;i++) arr[i].ms=String(i+1).padStart(3,"0"); writeAccountsToLS(arr); renderAccounts(); }
function editAccountLocal(idx){ if(!currentUser||currentUser.role!=="admin") return; const arr=readAccountsFromLS(); const acc=arr[idx]; const u=prompt("S·ª≠a Username",acc.username); if(u===null) return; const p=prompt("S·ª≠a Password",acc.password); if(p===null) return; const s=prompt("S·ª≠a Skin",acc.skin); if(s===null) return; const i=prompt("S·ª≠a Link ·∫¢nh",acc.image); if(i===null) return; const st=prompt("S·ª≠a T√¨nh Tr·∫°ng (ON/OFF)",acc.status); if(st===null) return; acc.username=u; acc.password=p; acc.skin=s; acc.image=i; acc.status=st; writeAccountsToLS(arr); renderAccounts(); }

/* Render accounts */
function renderAccounts(){
  const tbody=document.querySelector("#accTable tbody");
  const thead=document.querySelector("#accTable thead tr");
  tbody.innerHTML="";
  const arr=readAccountsFromLS();
  const filter=(el("filter").value||"").toLowerCase();
  if(currentUser&&currentUser.role==="admin"){
    thead.innerHTML=`<th style="width:80px">MS</th><th>Username</th><th>Password</th><th>Skin</th><th style="width:100px">·∫¢nh</th><th>T√¨nh Tr·∫°ng Ch·ªß</th><th style="width:180px">H√†nh ƒë·ªông</th>`;
  } else {
    thead.innerHTML=`<th style="width:80px">MS</th><th>Skin</th><th style="width:100px">·∫¢nh</th><th>T√¨nh Tr·∫°ng Ch·ªß</th>`;
  }
  arr.forEach((a,idx)=>{
    const rowText=(a.ms+" "+(a.username||"")+" "+(a.skin||"")).toLowerCase();
    if(filter && !rowText.includes(filter)) return;
    const tr=document.createElement("tr");
    if(currentUser&&currentUser.role==="admin"){
      tr.innerHTML=`<td>${a.ms}</td><td>${a.username||""}</td><td>${a.password||""}</td><td>${a.skin||""}</td><td>${a.image?'<img class="thumb" src="'+a.image+'">':''}</td><td>${a.status||"OFF"}</td><td><button onclick="editAccountLocal(${idx})">‚úèÔ∏è S·ª≠a</button><button onclick="deleteAccountLocal(${idx})">üóëÔ∏è X√≥a</button></td>`;
    } else {
      tr.innerHTML=`<td>${a.ms}</td><td>${a.skin||""}</td><td>${a.image?'<img class="thumb" src="'+a.image+'">':''}</td><td>${a.status||"OFF"}</td>`;
    }
    tbody.appendChild(tr);
  });
}

/* Export CSV */
function exportCSV(){ const arr=readAccountsFromLS(); const header=['MS','Username','Password','Skin','Image','Status']; const rows=[header].concat(arr.map(a=>[a.ms,a.username,(currentUser.role==='admin')?a.password:'',a.skin||'',a.image||'',a.status||'OFF'])); const csv=rows.map(r=>r.map(c=>'"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='accounts.csv'; a.click(); URL.revokeObjectURL(url); }

/* Event listeners */
el("btnLogin").addEventListener("click",doLogin);
el("btnAdd").addEventListener("click",addAccountLocal);
el("btnExport").addEventListener("click",exportCSV);
el("filter").addEventListener("input",renderAccounts);
loadRemoteUsers();
</script>

</body>
</html>
