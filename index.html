<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Qu·∫£n l√Ω t√†i kho·∫£n</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Baloo 2',cursive;background:linear-gradient(135deg,#e6f7ff,#f0faff);min-height:100vh;color:#333;}
.wrap{max-width:980px;margin:30px auto;padding:18px;display:none;}
.card{background:#fff;border-radius:16px;padding:20px;box-shadow:0 6px 18px rgba(0,0,0,0.05);margin-bottom:18px;}
h1,h2,h3{margin:0 0 12px 0;color:#007acc;}
.row{display:flex;gap:10px;flex-wrap:wrap;}
input{padding:10px 14px;border-radius:10px;border:2px solid #ccecff;outline:none;transition:0.2s;}
input:focus{border-color:#66c2ff;box-shadow:0 0 6px #b3e0ff;}
button{padding:10px 16px;border-radius:20px;border:0;background:linear-gradient(45deg,#66c2ff,#99ddff);color:#fff;cursor:pointer;font-weight:500;transition:0.3s;}
button:hover{transform:scale(1.05);background:linear-gradient(45deg,#3399ff,#66ccff);}
button.ghost{background:#f0faff;border:1px solid #99ddff;color:#007acc;}
table{width:100%;border-collapse:separate;border-spacing:0 10px;margin-top:12px;}
th,td{padding:12px;background:#fff;border-radius:10px;box-shadow:0 1px 4px rgba(0,0,0,0.04);}
th{background:#e6f7ff;color:#007acc;font-size:14px;}
img.thumb{width:72px;height:72px;object-fit:cover;border-radius:10px;border:2px solid #cceeff;}
.logo{width:48px;height:48px;vertical-align:middle;margin-right:8px;}
.muted{color:#666;font-size:13px;}
.right{margin-left:auto;}
/* Overlay */
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#e6f7ff,#f0faff);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:9999;transition:opacity 0.5s;}
#overlay.hide{opacity:0;pointer-events:none;}
#welcomeText{font-family:'Pacifico',cursive;font-size:48px;color:#007acc;display:flex;justify-content:center;flex-wrap:wrap;position:relative;}
#welcomeText span{opacity:0;transform:translateY(-10px);animation:typeIn 0.5s forwards;}
@keyframes typeIn{to{opacity:1;transform:translateY(0);}}
.sparkle{position:absolute;font-size:24px;animation:floatUp 3s linear infinite;}
@keyframes floatUp{0%{opacity:1;transform:translateY(0) rotate(0deg);}100%{opacity:0;transform:translateY(-200px) rotate(360deg);}}
#btnContinue{margin-top:40px;padding:12px 28px;font-size:20px;border:none;border-radius:24px;background:linear-gradient(45deg,#66c2ff,#99ddff);color:white;cursor:pointer;transition:0.3s;}
#btnContinue:hover{transform:scale(1.1);}
#roleSelect,#waitingBox{display:none;flex-direction:column;align-items:center;}
.roleBtn{margin:8px;padding:16px 28px;border-radius:50%;border:none;background:linear-gradient(45deg,#66c2ff,#99ddff);color:white;font-size:20px;cursor:pointer;transition:0.3s;}
.roleBtn:hover{transform:scale(1.2);}
#progressBarContainer{display:none;width:80%;height:24px;background:#cceeff;border-radius:12px;margin-top:20px;overflow:hidden;}
#progressBar{width:0%;height:100%;background:#66c2ff;border-radius:12px;transition:width 0.1s linear;}
</style>
</head>
<body>

<div id="overlay">
  <div id="welcomeText"></div>
  <button id="btnContinue">Ti·∫øp t·ª•c</button>
  <div id="roleSelect">
    <p>B·∫°n l√† ai ?</p>
    <div style="display:flex;">
      <button class="roleBtn" data-name="Giao B√©o">Giao B√©o</button>
      <button class="roleBtn" data-name="Qu·ª≥nh Cute">Qu·ª≥nh Cute</button>
    </div>
  </div>
  <div id="waitingBox">
    <p id="waitingMsg"></p>
    <div id="progressBarContainer"><div id="progressBar"></div></div>
  </div>
</div>

<div class="wrap" id="mainApp">
  <div class="card" id="loginCard">
    <h1>
      <span class="logo">üåü</span> C·ªông T√°c Vi√™n H·ªù G·ªù
    </h1>
    <h2>ƒêƒÉng nh·∫≠p</h2>
    <div class="row">
      <input id="login_username" placeholder="username" />
      <input id="login_password" placeholder="password" type="password" />
      <button id="btnLogin">ƒêƒÉng nh·∫≠p</button>
    </div>
    <p id="loginMsg" class="muted"></p>
  </div>

  <div class="card" id="appCard" style="display:none;">
    <div style="display:flex;align-items:center;">
      <h2 style="margin:0">üìã Qu·∫£n l√Ω t√†i kho·∫£n</h2>
      <div class="right muted">Role: <b id="roleLabel">-</b></div>
    </div>

    <div id="adminPanel" style="margin-top:12px;display:none;">
      <h3>‚ûï Th√™m t√†i kho·∫£n (Admin)</h3>
      <div class="row">
        <input id="new_user" placeholder="T√†i kho·∫£n (username)" />
        <input id="new_pass" placeholder="M·∫≠t kh·∫©u" />
        <input id="new_skin" placeholder="Skin" />
        <input id="new_img" placeholder="Link ·∫£nh (https://...)" />
        <select id="new_status">
          <option value="ON">ON</option>
          <option value="OFF">OFF</option>
        </select>
        <button id="btnAdd">Th√™m</button>
      </div>
    </div>

    <div style="margin-top:12px;">
      <div class="row">
        <input id="filter" placeholder="üîç T√¨m MS / username / skin..." style="flex:1" />
        <button id="btnExport" class="ghost">üìÇ Xu·∫•t CSV</button>
      </div>
    </div>

    <table id="accTable">
      <thead><tr></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
const RAW_USERS_URL="https://raw.githubusercontent.com/HoshinoKotaSouma/ctvhogo/refs/heads/main/accounts.json";
let usersRemote=null,currentUser=null,accountsLSKey="lq_accounts_v1";
function el(id){return document.getElementById(id);}
function show(msg){el("loginMsg").innerText=msg||"";}
async function loadRemoteUsers(){try{const res=await fetch(RAW_USERS_URL+"?_="+Date.now(),{cache:"no-store"});if(!res.ok)throw new Error(res.status);const data=await res.json();usersRemote=data.users||null;return usersRemote;}catch(e){console.error(e);usersRemote=null;show("L·ªói khi t·∫£i users: "+e.message);return null;}}

function typewriter(text,container){container.innerHTML="";text.split("").forEach((ch,i)=>{const span=document.createElement("span");span.innerText=ch;span.style.animationDelay=(i*0.1)+"s";container.appendChild(span);});}
typewriter("üå∏ Welcomeeee üíô ‚ú®",el("welcomeText"));

el("btnContinue").addEventListener("click",()=>{el("overlay").classList.add("hide");el("mainApp").style.display="block";});

async function doLogin(){
  const u=el("login_username").value.trim(),p=el("login_password").value;
  if(!u||!p){show("Nh·∫≠p username + password");return;}
  if(!usersRemote){await loadRemoteUsers();if(!usersRemote){show("Kh√¥ng c√≥ users ƒë·ªÉ ki·ªÉm tra");return;}}
  let found=null;for(const k in usersRemote){const it=usersRemote[k];if(it.username===u&&it.password===p){found={username:it.username,role:it.role};break;}}
  if(!found){show("Sai username ho·∫∑c m·∫≠t kh·∫©u!");return;}
  currentUser=found;
  el("loginCard").style.display="none";
  const waiting=el("waitingBox");waiting.style.display="flex";el("progressBarContainer").style.display="block";
  if(currentUser.role==="admin"){el("roleSelect").style.display="flex";document.querySelectorAll(".roleBtn").forEach(b=>{b.onclick=()=>{el("roleSelect").style.display="none";startProgress();};});}else{el("waitingMsg").innerText="B·∫°n l√† c·ªông t√°c vi√™n";startProgress();}
}
function startProgress(){const bar=el("progressBar");bar.style.width="0%";let p=0;const interval=setInterval(()=>{p+=2;if(p>=100){clearInterval(interval);startApp();}bar.style.width=p+"%";},30);}
function startApp(){el("appCard").style.display="block";el("roleLabel").innerText=currentUser.role.toUpperCase();if(currentUser.role==="admin")el("adminPanel").style.display="block";else el("adminPanel").style.display="none";renderAccounts();}

function readAccountsFromLS(){try{return JSON.parse(localStorage.getItem(accountsLSKey)||"[]");}catch(e){return[];}}
function writeAccountsToLS(arr){localStorage.setItem(accountsLSKey,JSON.stringify(arr));}
function nextMS(arr){return String(arr.length+1).padStart(3,"0");}
function addAccountLocal(){if(!currentUser||currentUser.role!=="admin")return alert("Ch·ªâ admin ƒë∆∞·ª£c th√™m");const u=el("new_user").value.trim();const p=el("new_pass").value;const skin=el("new_skin").value.trim();const img=el("new_img").value.trim();const status=el("new_status").value;if(!u||!p){alert("Nh·∫≠p username + password cho acc");return;}const arr=readAccountsFromLS();arr.push({ms:nextMS(arr),username:u,password:p,skin:skin,image:img,status:status});writeAccountsToLS(arr);renderAccounts();el("new_user").value="";el("new_pass").value="";el("new_skin").value="";el("new_img").value="";}
function deleteAccountLocal(idx){if(!currentUser||currentUser.role!=="admin")return;if(!confirm("X√≥a acc MS "+String(idx+1).padStart(3,"0")+" ?"))return;const arr=readAccountsFromLS();arr.splice(idx,1);for(let i=0;i<arr.length;i++)arr[i].ms=String(i+1).padStart(3,"0");writeAccountsToLS(arr);renderAccounts();}
function editAccountLocal(idx){if(!currentUser||currentUser.role!=="admin")return;const arr=readAccountsFromLS();const acc=arr[idx];const u=prompt("S·ª≠a Username",acc.username);if(u===null)return;const p=prompt("S·ª≠a Password",acc.password);if(p===null)return;const s=prompt("S·ª≠a Skin",acc.skin);if(s===null)return;const i=prompt("S·ª≠a Link ·∫¢nh",acc.image);if(i===null)return;const st=prompt("S·ª≠a T√¨nh Tr·∫°ng (ON/OFF)",acc.status);if(st===null)return;acc.username=u;acc.password=p;acc.skin=s;acc.image=i;acc.status=st;writeAccountsToLS(arr);renderAccounts();}
function renderAccounts(){const tbody=document.querySelector("#accTable tbody");const thead=document.querySelector("#accTable thead tr");tbody.innerHTML="";const arr=readAccountsFromLS();const filter=(el("filter").value||"").toLowerCase();if(currentUser&&currentUser.role==="admin"){thead.innerHTML=`<th style="width:80px">MS</th><th>Username</th><th>Password</th><th>Skin</th><th style="width:100px">·∫¢nh</th><th>T√¨nh Tr·∫°ng Ch·ªß</th><th style="width:180px">H√†nh ƒë·ªông</th>`;}else{thead.innerHTML=`<th style="width:80px">MS</th><th>Skin</th><th style="width:100px">·∫¢nh</th><th>T√¨nh Tr·∫°ng Ch·ªß</th>`;}
arr.forEach((a,idx)=>{const rowText=(a.ms+" "+(a.username||"")+" "+(a.skin||"")).toLowerCase();if(filter&&!rowText.includes(filter))return;const tr=document.createElement("tr");if(currentUser&&currentUser.role==="admin"){tr.innerHTML=`<td>${a.ms}</td><td>${a.username||""}</td><td>${a.password||""}</td><td>${a.skin||""}</td><td>${a.image?'<img class="thumb" src="'+a.image+'">':''}</td><td>${a.status||"OFF"}</td><td><button onclick="editAccountLocal(${idx})">‚úèÔ∏è S·ª≠a</button><button onclick="deleteAccountLocal(${idx})">üóëÔ∏è X√≥a</button></td>`;}else{tr.innerHTML=`<td>${a.ms}</td><td>${a.skin||""}</td><td>${a.image?'<img class="thumb" src="'+a.image+'">':''}</td><td>${a.status||"OFF"}</td>`;}tbody.appendChild(tr);});
}
function exportCSV(){const arr=readAccountsFromLS();const header=['MS','Username','Password','Skin','Image','Status'];const rows=[header].concat(arr.map(a=>[a.ms,a.username,(currentUser&&currentUser.role==='admin')?a.password:'',a.skin||'',a.image||'',a.status||'OFF']));const csv=rows.map(r=>r.map(c=>'"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='accounts.csv';a.click();URL.revokeObjectURL(url);}
el("btnLogin").addEventListener("click",doLogin);
el("btnAdd").addEventListener("click",addAccountLocal);
el("btnExport").addEventListener("click",exportCSV);
el("filter").addEventListener("input",renderAccounts);
loadRemoteUsers();
</script>
</body>
</html>
