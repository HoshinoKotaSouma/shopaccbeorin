<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Qu·∫£n l√Ω t√†i kho·∫£n Li√™n Qu√¢n</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --blue1: #e6f7ff;
  --blue2: #f0faff;
  --accent: #007acc;
  --accent2: #66c2ff;
  --muted: #666;
  --success: #00c853;
  --warning: #ff9800;
  --error: #f44336;
  --pink: #ff6b9d;
  --purple: #9d4edd;
  --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

[data-theme="dark"] {
  --blue1: #1a1a2e;
  --blue2: #16213e;
  --accent: #4dabf7;
  --accent2: #339af0;
  --muted: #adb5bd;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, var(--blue1), var(--blue2));
  min-height: 100vh;
  color: #222;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow-x: hidden;
}

/* Floating Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-10px) rotate(2deg); }
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 20px rgba(102, 194, 255, 0.3); }
  50% { box-shadow: 0 0 30px rgba(102, 194, 255, 0.6); }
}

@keyframes slideIn {
  from { 
    opacity: 0;
    transform: translateY(30px) scale(0.9);
  }
  to { 
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
  40% {transform: translateY(-10px);}
  60% {transform: translateY(-5px);}
}

@keyframes sparkle {
  0% { transform: scale(0) rotate(0deg); opacity: 0; }
  50% { transform: scale(1) rotate(180deg); opacity: 1; }
  100% { transform: scale(0) rotate(360deg); opacity: 0; }
}

/* Cute Elements */
.cute-badge {
  background: linear-gradient(45deg, var(--pink), var(--purple));
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  animation: float 3s ease-in-out infinite;
}

.sparkle {
  position: absolute;
  width: 20px;
  height: 20px;
  background: radial-gradient(circle, #fff 20%, transparent 70%);
  border-radius: 50%;
  animation: sparkle 2s linear infinite;
}

.wrap {
  max-width: 1400px;
  margin: 20px auto;
  padding: 16px;
  animation: slideIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 24px;
  margin-bottom: 24px;
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.1),
    0 2px 8px rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  transition: left 0.6s;
}

.card:hover::before {
  left: 100%;
}

.card:hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow: 
    0 15px 40px rgba(0, 0, 0, 0.15),
    0 5px 15px rgba(0, 0, 0, 0.1);
}

[data-theme="dark"] .card {
  background: rgba(45, 55, 72, 0.95);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

h1, h2, h3 {
  margin: 0 0 16px;
  color: var(--accent);
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  position: relative;
}

h1::after, h2::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 0;
  width: 50px;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  border-radius: 2px;
}

input, select, textarea {
  padding: 12px 16px;
  border: 2px solid #cdeeff;
  border-radius: 12px;
  outline: none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  background: rgba(255, 255, 255, 0.9);
  font-family: 'Poppins', sans-serif;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--accent2);
  box-shadow: 0 0 0 3px rgba(102, 194, 255, 0.3);
  transform: scale(1.02);
}

[data-theme="dark"] input, 
[data-theme="dark"] select, 
[data-theme="dark"] textarea {
  background: rgba(74, 85, 104, 0.9);
  border-color: #718096;
  color: #e2e8f0;
}

button {
  padding: 12px 20px;
  border-radius: 15px;
  border: 0;
  background: linear-gradient(135deg, var(--accent2), var(--accent));
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-family: 'Poppins', sans-serif;
  position: relative;
  overflow: hidden;
}

button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: left 0.5s;
}

button:hover::before {
  left: 100%;
}

button:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 
    0 10px 25px rgba(102, 194, 255, 0.4),
    0 5px 10px rgba(102, 194, 255, 0.2);
  animation: glow 2s ease-in-out infinite;
}

button:active {
  transform: translateY(-1px) scale(1.02);
}

button.ghost {
  background: rgba(246, 253, 255, 0.8);
  border: 2px solid var(--accent2);
  color: var(--accent);
  backdrop-filter: blur(10px);
}

button.ghost:hover {
  background: var(--accent2);
  color: white;
}

[data-theme="dark"] button.ghost {
  background: rgba(74, 85, 104, 0.8);
  border-color: #718096;
  color: #e2e8f0;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 12px;
  margin-top: 16px;
}

th, td {
  padding: 16px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  vertical-align: middle;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

th:hover, td:hover {
  transform: translateX(5px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
}

[data-theme="dark"] th, 
[data-theme="dark"] td {
  background: rgba(74, 85, 104, 0.9);
  color: #e2e8f0;
}

th {
  background: linear-gradient(135deg, var(--blue1), var(--blue2));
  color: var(--accent);
  font-weight: 600;
  position: relative;
}

[data-theme="dark"] th {
  background: linear-gradient(135deg, #2d3748, #4a5568);
}

img.thumb {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border-radius: 12px;
  border: 2px solid #dff4ff;
  transition: all 0.3s ease;
  cursor: pointer;
}

img.thumb:hover {
  transform: scale(1.1) rotate(2deg);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.logo {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  border: 3px solid #cfefff;
  animation: float 4s ease-in-out infinite;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

#loadingOverlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  background: linear-gradient(135deg, rgba(230,247,255,0.98), rgba(240,250,255,0.98));
  z-index: 9999;
  text-align: center;
  transition: opacity 1s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="dark"] #loadingOverlay {
  background: linear-gradient(135deg, rgba(26,26,46,0.98), rgba(22,33,62,0.98));
}

#loadingOverlay.fade-out {
  opacity: 0;
  pointer-events: none;
}

#popup {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  backdrop-filter: blur(5px);
}

#popupContent {
  background: rgba(255, 255, 255, 0.95);
  padding: 30px;
  border-radius: 20px;
  max-width: 900px;
  max-height: 80%;
  overflow: auto;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="dark"] #popupContent {
  background: rgba(74, 85, 104, 0.95);
  color: #e2e8f0;
}

.hero-grid label {
  margin-right: 12px;
  display: inline-block;
  padding: 8px 16px;
  background: rgba(247, 253, 255, 0.8);
  border: 2px solid #e6fbff;
  border-radius: 12px;
  margin: 6px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(10px);
}

.hero-grid label:hover {
  background: rgba(230, 247, 255, 0.9);
  border-color: var(--accent2);
  transform: translateY(-2px) scale(1.05);
}

.hero-grid input:checked + span {
  font-weight: 700;
  color: var(--accent);
  text-shadow: 0 2px 4px rgba(0, 122, 204, 0.2);
}

.skin-grid label {
  display: inline-block;
  margin: 8px;
  border-radius: 10px;
  padding: 8px 12px;
  background: rgba(247, 253, 255, 0.8);
  border: 2px solid #e6fbff;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  backdrop-filter: blur(10px);
}

.skin-grid label:hover {
  transform: translateY(-2px) scale(1.05);
  border-color: var(--accent2);
}

[data-theme="dark"] .skin-grid label {
  background: rgba(45, 55, 72, 0.8);
  border-color: #4a5568;
}

.controls {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

.muted {
  color: var(--muted);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin: 20px 0;
}

.stat-card {
  background: linear-gradient(135deg, var(--blue1), var(--blue2));
  padding: 20px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.stat-card:hover {
  transform: translateY(-5px) scale(1.05);
}

.stat-card:nth-child(1) { animation-delay: 0.1s; }
.stat-card:nth-child(2) { animation-delay: 0.2s; }
.stat-card:nth-child(3) { animation-delay: 0.3s; }
.stat-card:nth-child(4) { animation-delay: 0.4s; }

.stat-number {
  font-size: 28px;
  font-weight: 700;
  color: var(--accent);
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.stat-label {
  font-size: 14px;
  color: var(--muted);
  margin-top: 8px;
}

.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 16px 24px;
  border-radius: 12px;
  color: white;
  z-index: 10001;
  transform: translateX(400px);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  max-width: 300px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.toast.show {
  transform: translateX(0);
}

.toast.success {
  background: linear-gradient(135deg, var(--success), #00e676);
}

.toast.error {
  background: linear-gradient(135deg, var(--error), #ff5252);
}

.toast.warning {
  background: linear-gradient(135deg, var(--warning), #ffb74d);
}

.toast.info {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
}

.tr-hot {
  border-left: 4px solid #ff4444 !important;
  animation: pulse 2s infinite;
}

.tr-new {
  border-left: 4px solid #44ff44 !important;
}

.tr-sold {
  border-left: 4px solid var(--muted) !important;
}

.theme-switch {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  padding: 10px;
  border-radius: 50%;
  transition: all 0.3s ease;
  animation: bounce 2s infinite;
}

.theme-switch:hover {
  transform: scale(1.2) rotate(15deg);
}

.advanced-filters {
  background: rgba(230, 247, 255, 0.8);
  padding: 16px;
  border-radius: 15px;
  margin: 16px 0;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.filter-group {
  display: flex;
  gap: 16px;
  align-items: center;
  flex-wrap: wrap;
  margin: 12px 0;
}

.quick-actions {
  display: flex;
  gap: 12px;
  margin: 16px 0;
  flex-wrap: wrap;
}

.hero-section {
  margin: 16px 0;
  padding: 16px;
  background: rgba(230, 247, 255, 0.6);
  border-radius: 15px;
  border: 2px solid rgba(102, 194, 255, 0.3);
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.hero-section:hover {
  border-color: var(--accent2);
  transform: translateY(-2px);
}

.hero-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.hero-skins {
  margin-left: 24px;
}

.selected-heroes {
  margin: 16px 0;
  padding: 16px;
  background: rgba(240, 255, 244, 0.8);
  border: 2px solid rgba(198, 246, 213, 0.6);
  border-radius: 12px;
  backdrop-filter: blur(10px);
  animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="dark"] .selected-heroes {
  background: rgba(45, 55, 72, 0.8);
  border-color: #4a5568;
}

/* Import section */
.import-section {
  margin: 16px 0;
  padding: 16px;
  background: rgba(255, 248, 225, 0.8);
  border: 2px solid rgba(255, 193, 7, 0.3);
  border-radius: 15px;
  backdrop-filter: blur(10px);
}

.import-preview {
  max-height: 300px;
  overflow-y: auto;
  margin: 12px 0;
  padding: 12px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 8px;
  border: 1px solid #dee2e6;
}

.preview-item {
  padding: 8px 12px;
  margin: 4px 0;
  background: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid var(--accent);
}

.preview-item.error {
  border-left-color: var(--error);
  background: #ffe6e6;
}

/* Cute floating elements */
.floating {
  position: absolute;
  pointer-events: none;
  z-index: -1;
}

.floating.heart {
  color: #ff6b9d;
  animation: float 6s ease-in-out infinite;
}

.floating.star {
  color: #ffd700;
  animation: float 8s ease-in-out infinite reverse;
}

/* Pulse animation */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Responsive */
@media (max-width: 800px) {
  .controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  table, th, td {
    font-size: 14px;
  }
  
  .stats-grid {
    grid-template-columns: 1fr 1fr;
  }
  
  .filter-group {
    flex-direction: column;
    align-items: stretch;
  }
  
  .card {
    padding: 20px;
    margin-bottom: 20px;
  }
}

@media (max-width: 600px) {
  .card {
    padding: 16px;
    margin: 12px;
  }
  
  button {
    padding: 10px 16px;
    font-size: 14px;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .quick-actions {
    justify-content: center;
  }
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(230, 247, 255, 0.5);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--accent2), var(--accent));
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
}

/* Loading dots animation */
@keyframes dotFlashing {
  0% { opacity: 0; }
  50% { opacity: 1; }
  100% { opacity: 0; }
}

.dot-flashing {
  position: relative;
  width: 10px;
  height: 10px;
  border-radius: 5px;
  background-color: var(--accent);
  color: var(--accent);
  animation: dotFlashing 1s infinite linear;
}

.dot-flashing::before, .dot-flashing::after {
  content: '';
  display: inline-block;
  position: absolute;
  top: 0;
}

.dot-flashing::before {
  left: -15px;
  width: 10px;
  height: 10px;
  border-radius: 5px;
  background-color: var(--accent);
  color: var(--accent);
  animation: dotFlashing 1s infinite linear;
  animation-delay: 0s;
}

.dot-flashing::after {
  left: 15px;
  width: 10px;
  height: 10px;
  border-radius: 5px;
  background-color: var(--accent);
  color: var(--accent);
  animation: dotFlashing 1s infinite linear;
  animation-delay: 1s;
}
</style>
</head>
<body>
<!-- Floating decorative elements -->
<div class="floating heart" style="top: 10%; left: 5%; font-size: 24px;">üíñ</div>
<div class="floating star" style="top: 20%; right: 8%; font-size: 20px;">‚≠ê</div>
<div class="floating heart" style="bottom: 15%; left: 7%; font-size: 18px;">üíù</div>
<div class="floating star" style="bottom: 25%; right: 5%; font-size: 22px;">üåü</div>

<div class="wrap">
  <!-- TOAST NOTIFICATION -->
  <div id="toastContainer"></div>

  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
      <div style="display:flex;align-items:center;gap:10px">
        <img class="logo" src="https://raw.githubusercontent.com/HoshinoKotaSouma/shopaccbeorin/main/download%20(3).jpeg" alt="logo">
        <div>
          <div style="font-weight:700;color:var(--accent);font-size:20px">C·ªông T√°c Vi√™n H·ªù G·ªù</div>
          <div class="muted" style="display:flex;align-items:center;gap:5px">
            <i class="fas fa-crown" style="color:gold"></i>
            H·ªá th·ªëng qu·∫£n l√Ω t√†i kho·∫£n
          </div>
        </div>
      </div>
      <button class="theme-switch" id="themeSwitch">üåô</button>
    </div>
    
    <h2 style="margin-top:16px;display:flex;align-items:center;gap:10px">
      <i class="fas fa-sign-in-alt"></i>
      ƒêƒÉng nh·∫≠p
    </h2>
    
    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
      <input id="login_username" placeholder="üë§ Username" style="flex:1;min-width:200px">
      <input id="login_password" placeholder="üîí Password" type="password" style="flex:1;min-width:200px">
      <button id="btnLogin" style="min-width:120px">
        <i class="fas fa-rocket"></i> ƒêƒÉng nh·∫≠p
      </button>
    </div>
    <p id="loginMsg" style="color:red;margin-top:12px;display:flex;align-items:center;gap:8px"></p>
  </div>

  <!-- APP -->
  <div class="card" id="appCard" style="display:none">
    <div style="display:flex;align-items:center;flex-wrap:wrap;gap:16px">
      <h2 style="display:flex;align-items:center;gap:12px">
        <i class="fas fa-tasks"></i>
        üìã Qu·∫£n l√Ω t√†i kho·∫£n
      </h2>
      <div class="controls" style="margin-left:auto">
        <div id="roleLabel" class="muted cute-badge"></div>
        <input id="filter" placeholder="üîç L·ªçc nhanh..." style="min-width:220px">
        <button id="btnFind" class="ghost"><i class="fas fa-search"></i> T√¨m Acc</button>
        <button id="btnStats" class="ghost"><i class="fas fa-chart-bar"></i> Th·ªëng k√™</button>
        <button id="btnManageSkins" class="ghost"><i class="fas fa-palette"></i> Skin</button>
        <button id="btnImport" class="ghost"><i class="fas fa-file-import"></i> Import</button>
        <button id="btnExport" class="ghost"><i class="fas fa-file-export"></i> Xu·∫•t CSV</button>
        <button id="btnTheme" class="theme-switch">üåô</button>
        <button id="btnLogout" class="ghost"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </div>

    <!-- STATS DASHBOARD -->
    <div id="statsDashboard" style="display:none">
      <h3 style="display:flex;align-items:center;gap:10px">
        <i class="fas fa-chart-pie"></i>
        üìä Dashboard Th·ªëng k√™
      </h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="statTotal">0</div>
          <div class="stat-label"><i class="fas fa-users"></i> T·ªïng s·ªë acc</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="statAvailable">0</div>
          <div class="stat-label"><i class="fas fa-check-circle"></i> Acc c√≥ s·∫µn</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="statSold">0</div>
          <div class="stat-label"><i class="fas fa-shopping-cart"></i> ƒê√£ b√°n</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="statRare">0</div>
          <div class="stat-label"><i class="fas fa-gem"></i> Acc hi·∫øm</div>
        </div>
      </div>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="quick-actions">
      <button id="btnMarkHot" class="ghost" style="background:linear-gradient(135deg, #ff6b6b, #ff8e8e)">
        <i class="fas fa-fire"></i> üî• ƒê√°nh d·∫•u HOT
      </button>
      <button id="btnMarkNew" class="ghost" style="background:linear-gradient(135deg, #51cf66, #69db7c)">
        <i class="fas fa-certificate"></i> üÜï ƒê√°nh d·∫•u NEW
      </button>
      <button id="btnAdvancedFilter" class="ghost">
        <i class="fas fa-sliders-h"></i> üéöÔ∏è L·ªçc n√¢ng cao
      </button>
    </div>

    <!-- ADVANCED FILTERS -->
    <div id="advancedFilters" class="advanced-filters" style="display:none">
      <h4 style="display:flex;align-items:center;gap:8px">
        <i class="fas fa-filter"></i>
        üéöÔ∏è L·ªçc n√¢ng cao
      </h4>
      <div class="filter-group">
        <div style="display:flex;align-items:center;gap:8px">
          <i class="fas fa-tag"></i>
          <label>Kho·∫£ng gi√°:</label>
          <input type="number" id="filterMinPrice" placeholder="T·ª´" style="width:100px">
          <input type="number" id="filterMaxPrice" placeholder="ƒê·∫øn" style="width:100px">
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <i class="fas fa-tshirt"></i>
          <label>S·ªë skin t·ªëi thi·ªÉu:</label>
          <input type="number" id="filterMinSkins" placeholder="0" style="width:80px">
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <i class="fas fa-power-off"></i>
          <label>Tr·∫°ng th√°i:</label>
          <select id="filterStatus">
            <option value="">T·∫•t c·∫£</option>
            <option value="ON">C√≥ s·∫µn</option>
            <option value="OFF">ƒê√£ b√°n</option>
          </select>
        </div>
        <button id="btnApplyFilter" class="ghost"><i class="fas fa-check"></i> √Åp d·ª•ng</button>
        <button id="btnResetFilter" class="ghost"><i class="fas fa-undo"></i> Reset</button>
      </div>
    </div>

    <!-- ADMIN FORM -->
    <div id="adminPanel" style="display:none;margin-top:16px">
      <h3 style="display:flex;align-items:center;gap:10px">
        <i class="fas fa-plus-circle"></i>
        ‚ûï Th√™m t√†i kho·∫£n
      </h3>
      
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
        <input id="new_user" placeholder="üë§ Username" style="flex:1;min-width:150px">
        <input id="new_pass" placeholder="üîí Password" style="flex:1;min-width:150px">
        <input id="new_price" placeholder="üí∞ Gi√° Acc" style="flex:1;min-width:120px">
        <input id="new_img" placeholder="üñºÔ∏è Link ·∫£nh" style="flex:2;min-width:200px">
        <select id="new_status" style="min-width:100px">
          <option>ON</option>
          <option>OFF</option>
        </select>
        <select id="new_tag" style="min-width:120px">
          <option value="">Kh√¥ng tag</option>
          <option value="hot">üî• HOT</option>
          <option value="new">üÜï NEW</option>
        </select>
      </div>

      <div style="display:flex;gap:12px;margin-top:16px">
        <button id="btnAddAccount"><i class="fas fa-plus"></i> Th√™m Acc</button>
        <button id="btnClearForm" class="ghost"><i class="fas fa-broom"></i> Clear Form</button>
      </div>
    </div>

    <!-- IMPORT SECTION -->
    <div id="importSection" class="import-section" style="display:none">
      <h3 style="display:flex;align-items:center;gap:10px">
        <i class="fas fa-file-import"></i>
        üì• Import t√†i kho·∫£n t·ª´ d·ªØ li·ªáu text
      </h3>
      
      <div style="margin:16px 0">
        <textarea id="importData" placeholder="D√°n d·ªØ li·ªáu t√†i kho·∫£n v√†o ƒë√¢y (m·ªói acc m·ªôt d√≤ng)...
V√≠ d·ª•: pkeohero197:Cocailon2812 | NAME : w8.4'affc | RANK : B.Kim V | LEVEL : 30 | QH : 0 | HERO : 114 | SKIN : 421 | BAN : NO | EMAIL : YES [ƒê√É X√ÅC TH·ª∞C] | SDT : YES | CMND : YES | AUTHEN : YES | FB : DIE | S√í : 0 | QU·ªêC GIA : VN | LOGIN L·∫¶N CU·ªêI : 09:00:01 26-07-2025 | SS : 29 [Valhein V≈© kh√≠ t·ªëi th∆∞·ª£ng, Yorn Th·∫ø t·ª≠ nguy·ªát t·ªôc, Murad Si√™u vi·ªát, ...] | SSS : 0 [] | ANIME : 0 [] | OTHER : 2 [Kaine Chi·∫øn binh kim quang, Kaine Thi·∫øu ch·ªß b√≥ng ƒë√™m] | TR·∫†NG TH√ÅI : ACC FULL‚Ä¶" 
          style="width:100%;height:150px;resize:vertical"></textarea>
      </div>
      
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <button id="btnParseData"><i class="fas fa-cogs"></i> Ph√¢n t√≠ch d·ªØ li·ªáu</button>
        <button id="btnImportAccounts" class="ghost" disabled><i class="fas fa-download"></i> Import t√†i kho·∫£n</button>
        <button id="btnClearImport" class="ghost"><i class="fas fa-times"></i> X√≥a d·ªØ li·ªáu</button>
        <span id="importStatus" class="muted"></span>
      </div>
      
      <div id="importPreview" class="import-preview" style="display:none">
        <h4>Preview t√†i kho·∫£n s·∫Ω import:</h4>
        <div id="previewList"></div>
      </div>
    </div>

    <!-- ACCOUNTS TABLE -->
    <div style="margin-top:20px">
      <h3 style="display:flex;align-items:center;gap:10px">
        <i class="fas fa-list"></i>
        üìã Danh s√°ch t√†i kho·∫£n
      </h3>
      <div id="accountsTable" style="overflow-x:auto">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Password</th>
              <th>Th√¥ng tin</th>
              <th>Gi√°</th>
              <th>·∫¢nh</th>
              <th>Tr·∫°ng th√°i</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody id="accountsBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- LOADING OVERLAY -->
<div id="loadingOverlay">
  <div style="text-align:center;animation:slideIn 0.8s cubic-bezier(0.4,0,0.2,1)">
    <div style="font-size:48px;margin-bottom:20px">üéÆ</div>
    <h1 id="welcomeText" style="font-size:2.5em;margin-bottom:20px">Welcomeeee... üíô</h1>
    <p id="roleMsg" style="font-size:1.2em;margin-bottom:20px"></p>
    <div id="chooseAdmin" style="display:none;margin-top:20px">
      <p style="font-weight:600;font-size:1.1em">B·∫°n l√† ai ?</p>
      <div style="display:flex;gap:15px;justify-content:center;margin-top:15px">
        <button id="who1" style="padding:12px 24px;font-size:16px">Giao B√©o</button>
        <button id="who2" style="padding:12px 24px;font-size:16px">Qu·ª≥nh Cute</button>
      </div>
    </div>
    <p id="waitingText" style="display:none;font-weight:600;margin-top:20px;font-size:1.1em">
      ƒêang t·∫£i <span class="dot-flashing"></span>
    </p>
  </div>
</div>

<!-- POPUP -->
<div id="popup"><div id="popupContent"></div></div>

<script type="module">
// ====== CONFIG ======
const RAW_USERS_URL = "https://raw.githubusercontent.com/HoshinoKotaSouma/ctvhogo/refs/heads/main/accounts.json";

// ====== STATE ======
let usersRemote = null;
let currentUser = null;
let accounts = JSON.parse(localStorage.getItem('accounts')) || [];
let selectedHeroes = {};
let parsedAccounts = [];
let dotsInterval = null;
let logoutTimer = null;

const el = id => document.getElementById(id);

// ====== TOAST NOTIFICATION ======
function showToast(message, type = 'info', duration = 3000) {
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <div style="display:flex;align-items:center;gap:10px">
      <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-circle' : 'info'}-circle"></i>
      <span>${message}</span>
    </div>
  `;
  el('toastContainer').appendChild(toast);
  
  setTimeout(() => toast.classList.add('show'), 100);
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 300);
  }, duration);
}

// ====== THEME MANAGEMENT ======
function initTheme() {
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.body.setAttribute('data-theme', savedTheme);
  updateThemeButton(savedTheme);
}

function toggleTheme() {
  const currentTheme = document.body.getAttribute('data-theme') || 'light';
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  document.body.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  updateThemeButton(newTheme);
  showToast(`ƒê√£ chuy·ªÉn sang ch·∫ø ƒë·ªô ${newTheme === 'light' ? 's√°ng üåû' : 't·ªëi üåô'}`, 'success');
}

function updateThemeButton(theme) {
  const buttons = document.querySelectorAll('.theme-switch');
  buttons.forEach(btn => {
    btn.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
    btn.innerHTML = theme === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
  });
}

// ====== AUTO LOGOUT ======
function resetLogoutTimer() {
  if (logoutTimer) clearTimeout(logoutTimer);
  logoutTimer = setTimeout(() => {
    showToast('T·ª± ƒë·ªông ƒëƒÉng xu·∫•t sau 30 ph√∫t kh√¥ng ho·∫°t ƒë·ªông', 'warning');
    logout();
  }, 30 * 60 * 1000);
}

// ====== Load users from GitHub RAW ======
async function loadUsers(){
  try{
    const res = await fetch(RAW_USERS_URL + "?_=" + Date.now(), {cache:"no-store"});
    if(!res.ok) throw new Error("Fetch failed: " + res.status);
    const data = await res.json();
    usersRemote = data.users || null;
    return usersRemote;
  }catch(e){
    console.error(e);
    usersRemote = null;
    el("loginMsg").innerText = "L·ªói t·∫£i users: " + e.message;
    return null;
  }
}

// ====== Login ======
async function doLogin(){
  const u = el("login_username").value.trim();
  const p = el("login_password").value;
  if(!u || !p){ 
    el("loginMsg").innerHTML = '<i class="fas fa-exclamation-triangle"></i> Nh·∫≠p username + password'; 
    return; 
  }
  if(!usersRemote) await loadUsers();
  if(!usersRemote){ 
    el("loginMsg").innerHTML = '<i class="fas fa-exclamation-triangle"></i> Kh√¥ng c√≥ users ƒë·ªÉ ki·ªÉm tra'; 
    return; 
  }
  let found = null;
  for(const k in usersRemote){
    const it = usersRemote[k];
    if(it.username === u && it.password === p){ found = { username: it.username, role: it.role }; break; }
  }
  if(!found){ 
    el("loginMsg").innerHTML = '<i class="fas fa-times-circle"></i> Sai username ho·∫∑c m·∫≠t kh·∫©u!'; 
    return; 
  }
  currentUser = found;
  el("loginCard").style.display = "none";
  startWelcome();
}

// ====== Welcome overlay flow ======
function startWelcome(){
  const overlay = el("loadingOverlay");
  overlay.style.display = "flex";
  el("roleMsg").innerText = "";
  el("chooseAdmin").style.display = "none";
  el("waitingText").style.display = "none";
  
  if(currentUser.role === "admin"){ 
    el("roleMsg").innerHTML = '<i class="fas fa-crown"></i> B·∫°n l√† qu·∫£n tr·ªã vi√™n'; 
    el("chooseAdmin").style.display = "block"; 
    el("who1").onclick = ()=>pickWho('Giao B√©o'); 
    el("who2").onclick = ()=>pickWho('Qu·ª≥nh Cute'); 
  } else { 
    el("roleMsg").innerHTML = '<i class="fas fa-user"></i> B·∫°n l√† c·ªông t√°c vi√™n'; 
    el("waitingText").style.display = "block"; 
    setTimeout(()=>fadeOutOverlay(startApp), 1800); 
  }
  startDots();
}

function pickWho(name){
  el("chooseAdmin").style.display = "none";
  el("waitingText").style.display = "block";
  setTimeout(()=>fadeOutOverlay(startApp), 1200);
}

function startDots(){
  const d = el("dots");
  if(dotsInterval) clearInterval(dotsInterval);
}

function fadeOutOverlay(cb){
  const overlay = el("loadingOverlay");
  overlay.classList.add("fade-out");
  setTimeout(()=>{ 
    overlay.style.display = "none"; 
    overlay.classList.remove("fade-out"); 
    if(dotsInterval){ 
      clearInterval(dotsInterval); 
      dotsInterval = null; 
    } 
    cb(); 
  }, 900);
}

// ====== Start app ======
function startApp(){
  el("appCard").style.display = "block";
  el("roleLabel").innerText = currentUser.role.toUpperCase();
  if(currentUser.role === "admin") el("adminPanel").style.display = "block"; 
  else el("adminPanel").style.display = "none";
  
  initTheme();
  loadAccounts();
  updateStats();
  resetLogoutTimer();
  
  document.addEventListener('mousemove', resetLogoutTimer);
  document.addEventListener('keypress', resetLogoutTimer);
  
  // Event listeners
  el("btnAddAccount").onclick = addAccount;
  el("btnExport").onclick = exportToCSV;
  el("btnLogout").onclick = logout;
  el("btnFind").onclick = openFindPanel;
  el("btnStats").onclick = toggleStats;
  el("btnManageSkins").onclick = manageSkins;
  el("btnTheme").onclick = toggleTheme;
  el("btnImport").onclick = toggleImportSection;
  el("btnAdvancedFilter").onclick = toggleAdvancedFilter;
  el("btnApplyFilter").onclick = applyAdvancedFilter;
  el("btnResetFilter").onclick = resetAdvancedFilter;
  el("btnMarkHot").onclick = () => markAccounts('hot');
  el("btnMarkNew").onclick = () => markAccounts('new');
  el("btnClearForm").onclick = clearForm;
  el("btnParseData").onclick = parseImportData;
  el("btnImportAccounts").onclick = importAccounts;
  el("btnClearImport").onclick = clearImport;
  
  el("filter").addEventListener("input", debounce(loadAccounts, 300));
  
  if(currentUser.role === "admin") {
    setInterval(() => {
      showToast('T·ª± ƒë·ªông backup d·ªØ li·ªáu...', 'info');
      exportToCSV();
    }, 24 * 60 * 60 * 1000);
  }
}

// ====== Debounce search ======
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// ====== Stats Dashboard ======
function toggleStats() {
  const stats = el('statsDashboard');
  stats.style.display = stats.style.display === 'none' ? 'block' : 'none';
  if (stats.style.display === 'block') updateStats();
}

function updateStats() {
  const total = accounts.length;
  const available = accounts.filter(a => a.status === 'ON').length;
  const sold = total - available;
  const rare = accounts.filter(a => {
    const skinCount = a.skinCount || 0;
    return skinCount >= 5;
  }).length;

  el('statTotal').textContent = total;
  el('statAvailable').textContent = available;
  el('statSold').textContent = sold;
  el('statRare').textContent = rare;
}

// ====== Advanced Filters ======
function toggleAdvancedFilter() {
  const filters = el('advancedFilters');
  filters.style.display = filters.style.display === 'none' ? 'block' : 'none';
}

function applyAdvancedFilter() {
  loadAccounts();
}

function resetAdvancedFilter() {
  el('filterMinPrice').value = '';
  el('filterMaxPrice').value = '';
  el('filterMinSkins').value = '';
  el('filterStatus').value = '';
  loadAccounts();
}

// ====== Bulk Operations ======
function markAccounts(tag) {
  if(!currentUser || currentUser.role !== "admin") return;
  const selected = accounts.filter(a => a.status === 'ON').slice(0, 5);
  
  if (selected.length === 0) {
    showToast('Kh√¥ng c√≥ acc n√†o ƒë·ªÉ ƒë√°nh d·∫•u!', 'warning');
    return;
  }
  
  selected.forEach(account => {
    account.tag = tag;
  });
  
  saveAccounts();
  loadAccounts();
  showToast(`ƒê√£ ƒë√°nh d·∫•u ${selected.length} acc l√† ${tag.toUpperCase()}`, 'success');
}

// ====== Skin Management ======
function manageSkins() {
  const html = `<h3><i class="fas fa-palette"></i> üé≠ Qu·∫£n l√Ω Skin</h3>
    <div style="max-height:400px;overflow-y:auto">
      <p>Ch·ª©c nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...</p>
    </div>
    <div style="margin-top:16px">
      <button onclick="closePopup()"><i class="fas fa-times"></i> ƒê√≥ng</button>
    </div>`;
  
  el("popupContent").innerHTML = html;
  el("popup").style.display = "flex";
}

// ====== ACCOUNT MANAGEMENT ======
function loadAccounts() {
  const accountsBody = el('accountsBody');
  accountsBody.innerHTML = '';
  
  const filteredAccounts = getFilteredAccounts();
  
  if (filteredAccounts.length === 0) {
    accountsBody.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:40px">Kh√¥ng c√≥ t√†i kho·∫£n n√†o!</td></tr>';
    return;
  }
  
  filteredAccounts.forEach((acc, index) => {
    const tr = document.createElement('tr');
    if (acc.tag === 'hot') tr.classList.add('tr-hot');
    else if (acc.tag === 'new') tr.classList.add('tr-new');
    else if (acc.status === 'OFF') tr.classList.add('tr-sold');
    
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td><strong>${acc.user}</strong></td>
      <td>${currentUser.role === 'admin' ? acc.pass : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'}</td>
      <td>
        <div style="max-width:300px">
          <strong>T∆∞·ªõng: ${acc.heroCount || 0}</strong><br>
          <strong>Skin: ${acc.skinCount || 0}</strong><br>
          <small class="muted">${acc.info || ''}</small>
        </div>
      </td>
      <td><strong style="color:var(--accent)">${acc.price}</strong></td>
      <td>
        ${acc.img ? `<img class="thumb" src="${acc.img}" alt="Account image" onclick="showImagePopup('${acc.img}')">` : 'No image'}
      </td>
      <td>
        <span class="cute-badge" style="background:${acc.status === 'ON' ? 'linear-gradient(135deg, #51cf66, #37b24d)' : 'linear-gradient(135deg, #ff6b6b, #fa5252)'}">
          ${acc.status === 'ON' ? 'üü¢ C√≥ s·∫µn' : 'üî¥ ƒê√£ b√°n'} ${acc.tag ? `(${acc.tag === 'hot' ? 'üî•' : 'üÜï'})` : ''}
        </span>
      </td>
      <td>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          ${currentUser.role === 'admin' ? `
            <button onclick="editAccount(${acc.id})" class="ghost" style="padding:6px 12px">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="deleteAccount(${acc.id})" class="ghost" style="padding:6px 12px;background:linear-gradient(45deg, #ff6b6b, #ff8e8e)">
              <i class="fas fa-trash"></i>
            </button>
          ` : ''}
          <button onclick="toggleStatus(${acc.id})" class="ghost" style="padding:6px 12px">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </td>
    `;
    accountsBody.appendChild(tr);
  });
}

function addAccount() {
  if(!currentUser || currentUser.role !== "admin"){ 
    showToast("Ch·ªâ admin ƒë∆∞·ª£c th√™m acc", "error"); 
    return; 
  }
  
  const user = el('new_user').value;
  const pass = el('new_pass').value;
  const price = el('new_price').value;
  const img = el('new_img').value;
  const status = el('new_status').value;
  const tag = el('new_tag').value;
  
  if (!user || !pass || !price) {
    showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
    return;
  }
  
  const newAccount = {
    id: Date.now(),
    user,
    pass,
    price: formatPrice(price),
    img,
    status,
    tag,
    info: 'Th√¥ng tin t√†i kho·∫£n',
    heroCount: 0,
    skinCount: 0,
    createdAt: new Date().toISOString()
  };
  
  accounts.push(newAccount);
  saveAccounts();
  loadAccounts();
  updateStats();
  clearForm();
  showToast('ƒê√£ th√™m t√†i kho·∫£n th√†nh c√¥ng!', 'success');
}

function editAccount(id) {
  const account = accounts.find(acc => acc.id === id);
  if (!account) return;
  
  // Fill form with account data
  el('new_user').value = account.user;
  el('new_pass').value = account.pass;
  el('new_price').value = account.price.replace(/\./g, '');
  el('new_img').value = account.img || '';
  el('new_status').value = account.status;
  el('new_tag').value = account.tag || '';
  
  // Scroll to form
  el('adminPanel').scrollIntoView({ behavior: 'smooth' });
  
  // Remove the account (will be re-added with updated info)
  deleteAccount(id, false);
  
  showToast('ƒê√£ chuy·ªÉn th√¥ng tin v√†o form ch·ªânh s·ª≠a!', 'info');
}

function deleteAccount(id, showNotification = true) {
  if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n n√†y?')) return;
  
  accounts = accounts.filter(acc => acc.id !== id);
  saveAccounts();
  loadAccounts();
  updateStats();
  
  if (showNotification) {
    showToast('ƒê√£ x√≥a t√†i kho·∫£n!', 'success');
  }
}

function toggleStatus(id) {
  const account = accounts.find(acc => acc.id === id);
  if (account) {
    account.status = account.status === 'ON' ? 'OFF' : 'ON';
    saveAccounts();
    loadAccounts();
    updateStats();
    showToast('ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i!', 'success');
  }
}

// ====== FILTER & SEARCH ======
function getFilteredAccounts() {
  let filtered = [...accounts];
  const filterText = el('filter').value.toLowerCase();
  
  if (filterText) {
    filtered = filtered.filter(acc => 
      acc.user.toLowerCase().includes(filterText) ||
      acc.pass.toLowerCase().includes(filterText) ||
      (acc.info && acc.info.toLowerCase().includes(filterText))
    );
  }
  
  // Apply advanced filters
  const minPrice = parseInt(el('filterMinPrice').value) || 0;
  const maxPrice = parseInt(el('filterMaxPrice').value) || Infinity;
  const minSkins = parseInt(el('filterMinSkins').value) || 0;
  const statusFilter = el('filterStatus').value;
  
  filtered = filtered.filter(acc => {
    const price = parseInt(acc.price.replace(/\./g, '')) || 0;
    const skinCount = acc.skinCount || 0;
    
    return price >= minPrice && 
           price <= maxPrice && 
           skinCount >= minSkins &&
           (statusFilter === '' || acc.status === statusFilter);
  });
  
  return filtered;
}

// ====== IMPORT FUNCTIONALITY ======
function toggleImportSection() {
  const section = el('importSection');
  section.style.display = section.style.display === 'none' ? 'block' : 'none';
}

function parseImportData() {
  const importData = el('importData').value.trim();
  if (!importData) {
    showToast('Vui l√≤ng nh·∫≠p d·ªØ li·ªáu c·∫ßn import!', 'error');
    return;
  }
  
  const lines = importData.split('\n').filter(line => line.trim());
  parsedAccounts = [];
  
  lines.forEach((line, index) => {
    try {
      const account = parseAccountLine(line);
      if (account) {
        parsedAccounts.push(account);
      }
    } catch (error) {
      console.error(`L·ªói ph√¢n t√≠ch d√≤ng ${index + 1}:`, error);
    }
  });
  
  if (parsedAccounts.length === 0) {
    showToast('Kh√¥ng th·ªÉ ph√¢n t√≠ch d·ªØ li·ªáu t·ª´ text!', 'error');
    return;
  }
  
  showImportPreview();
  el('btnImportAccounts').disabled = false;
  el('importStatus').textContent = `ƒê√£ ph√¢n t√≠ch ${parsedAccounts.length} t√†i kho·∫£n`;
  showToast(`ƒê√£ ph√¢n t√≠ch th√†nh c√¥ng ${parsedAccounts.length} t√†i kho·∫£n!`, 'success');
}

function parseAccountLine(line) {
  const parts = line.split(' | ');
  if (parts.length < 3) return null;
  
  // Parse username and password
  const [user, pass] = parts[0].split(':');
  if (!user || !pass) return null;
  
  const account = {
    id: Date.now() + Math.random(),
    user: user.trim(),
    pass: pass.trim(),
    status: 'ON',
    tag: '',
    img: '',
    createdAt: new Date().toISOString()
  };
  
  // Parse other fields
  parts.forEach(part => {
    if (part.includes('NAME :')) {
      account.name = part.split('NAME :')[1]?.trim();
    } else if (part.includes('RANK :')) {
      account.rank = part.split('RANK :')[1]?.trim();
    } else if (part.includes('LEVEL :')) {
      account.level = parseInt(part.split('LEVEL :')[1]) || 0;
    } else if (part.includes('HERO :')) {
      account.heroCount = parseInt(part.split('HERO :')[1]) || 0;
    } else if (part.includes('SKIN :')) {
      account.skinCount = parseInt(part.split('SKIN :')[1]) || 0;
    } else if (part.includes('SS :')) {
      const skinPart = part.split('SS :')[1];
      if (skinPart) {
        const skinMatch = skinPart.match(/\[(.*?)\]/);
        if (skinMatch && skinMatch[1]) {
          account.skins = skinMatch[1].split(', ').filter(s => s.trim());
        }
      }
    }
  });
  
  // Generate price based on heroes and skins
  const basePrice = 50000;
  const heroPrice = (account.heroCount || 0) * 10000;
  const skinPrice = (account.skinCount || 0) * 5000;
  const rareSkinBonus = (account.skins?.filter(s => s.includes('Si√™u vi·ªát') || s.includes('SSS')).length || 0) * 20000;
  
  account.price = formatPrice(basePrice + heroPrice + skinPrice + rareSkinBonus);
  account.info = `Rank: ${account.rank || 'Unknown'} | Level: ${account.level || 0} | T∆∞·ªõng: ${account.heroCount || 0} | Skin: ${account.skinCount || 0}`;
  
  return account;
}

function showImportPreview() {
  const previewList = el('previewList');
  previewList.innerHTML = '';
  
  parsedAccounts.forEach((acc, index) => {
    const div = document.createElement('div');
    div.className = 'preview-item';
    div.innerHTML = `
      <strong>${index + 1}. ${acc.user}:${acc.pass}</strong><br>
      <small>${acc.info} | Gi√°: ${acc.price}</small>
      ${acc.skins ? `<br><small>Skin: ${acc.skins.slice(0, 3).join(', ')}${acc.skins.length > 3 ? '...' : ''}</small>` : ''}
    `;
    previewList.appendChild(div);
  });
  
  el('importPreview').style.display = 'block';
}

function importAccounts() {
  if(!currentUser || currentUser.role !== "admin"){ 
    showToast("Ch·ªâ admin ƒë∆∞·ª£c import acc", "error"); 
    return; 
  }
  
  if (parsedAccounts.length === 0) {
    showToast('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ import!', 'error');
    return;
  }
  
  parsedAccounts.forEach(acc => {
    accounts.push(acc);
  });
  
  saveAccounts();
  loadAccounts();
  updateStats();
  
  showToast(`ƒê√£ import th√†nh c√¥ng ${parsedAccounts.length} t√†i kho·∫£n!`, 'success');
  clearImport();
}

function clearImport() {
  el('importData').value = '';
  el('importPreview').style.display = 'none';
  el('btnImportAccounts').disabled = true;
  el('importStatus').textContent = '';
  parsedAccounts = [];
}

// ====== UTILITY FUNCTIONS ======
function formatPrice(price) {
  const num = typeof price === 'string' ? parseInt(price.replace(/\./g, '')) : parseInt(price);
  return isNaN(num) ? '0' : num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function saveAccounts() {
  localStorage.setItem('accounts', JSON.stringify(accounts));
}

function clearForm() {
  el('new_user').value = '';
  el('new_pass').value = '';
  el('new_price').value = '';
  el('new_img').value = '';
  el('new_status').value = 'ON';
  el('new_tag').value = '';
}

// ====== Find panel for CTV ======
function openFindPanel(){
  if(!currentUser || currentUser.role !== 'ctv') return showToast("Ch·ª©c nƒÉng t√¨m ch·ªâ d√†nh cho CTV", "warning");
  
  const html = `
    <h3><i class="fas fa-search"></i> T√¨m Acc</h3>
    <div style="margin-top:16px">
      <div style="display:flex;gap:12px;align-items:center">
        <i class="fas fa-hashtag"></i>
        <span>Nh·∫≠p MS (vd: 001):</span>
        <input id="findMS" style="flex:1">
        <button id="doFindMS"><i class="fas fa-search"></i> T√¨m</button>
      </div>
      <div id="findResult" style="margin-top:16px"></div>
    </div>
    <div style="margin-top:16px">
      <button onclick="closePopup()"><i class="fas fa-times"></i> ƒê√≥ng</button>
    </div>`;
  
  el("popupContent").innerHTML = html; 
  el("popup").style.display = "flex";
  
  el("doFindMS").onclick = ()=>{ 
    const ms = parseInt(el("findMS").value.trim()); 
    const result = accounts.find(acc => acc.id === ms);
    const findResult = el("findResult");
    
    if (result) {
      findResult.innerHTML = `
        <div style="padding:16px;border-radius:12px;border:2px solid #eef; background:rgba(255,255,255,0.9)">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <strong><i class="fas fa-hashtag"></i> MS: ${result.id}</strong>
              <span style="margin-left:16px"><i class="fas fa-tag"></i> Gi√°: ${result.price}</span>
            </div>
            <span class="cute-badge" style="background:${result.status === 'ON' ? 'linear-gradient(135deg, #51cf66, #37b24d)' : 'linear-gradient(135deg, #ff6b6b, #fa5252)'}">
              ${result.status}
            </span>
          </div>
          <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
            ${result.img?'<img src="'+result.img+'" class="thumb" style="flex-shrink:0">':''}
            <div style="flex:1">
              <div><strong>Th√¥ng tin:</strong> ${result.info}</div>
              ${result.tag ? `<div style="margin-top:4px"><strong>Tag:</strong> ${result.tag === 'hot' ? 'üî• HOT' : 'üÜï NEW'}</div>` : ''}
            </div>
          </div>
        </div>
      `;
    } else {
      findResult.innerHTML = `
        <div style="text-align:center;padding:20px;background:rgba(255,255,255,0.8);border-radius:12px">
          <i class="fas fa-search" style="font-size:48px;color:#ccc;margin-bottom:12px"></i>
          <div>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o</div>
        </div>
      `;
    }
  };
}

function showImagePopup(imgSrc) {
  const html = `
    <div style="text-align:center">
      <img src="${imgSrc}" style="max-width:100%;max-height:70vh;border-radius:12px">
    </div>
    <div style="margin-top:16px;text-align:center">
      <button onclick="closePopup()"><i class="fas fa-times"></i> ƒê√≥ng</button>
    </div>
  `;
  el("popupContent").innerHTML = html;
  el("popup").style.display = "flex";
}

// ====== Close popup ======
function closePopup(){ el("popup").style.display = "none"; }

// ====== Export CSV ======
function exportToCSV(){
  const headers = ['ID','Username','Password','Th√¥ng tin','Gi√°','Tr·∫°ng th√°i','Tag','Ng√†y t·∫°o'];
  const csvData = accounts.map(acc => [
    acc.id,
    acc.user,
    currentUser.role === 'admin' ? acc.pass : '***',
    acc.info || '',
    acc.price,
    acc.status,
    acc.tag || '',
    new Date(acc.createdAt).toLocaleDateString('vi-VN')
  ]);
  
  const csv = [headers, ...csvData]
    .map(row => row.map(c => `"${String(c).replace(/"/g, '""')}"`).join(','))
    .join('\n');
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `accounts_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
  
  showToast(`ƒê√£ xu·∫•t ${accounts.length} t√†i kho·∫£n!`, 'success');
}

// ====== Logout ======
function logout(){ 
  if (logoutTimer) clearTimeout(logoutTimer);
  location.reload(); 
}

// ====== Helpers ======
el("btnLogin").addEventListener("click", doLogin);
el("themeSwitch").addEventListener("click", toggleTheme);

// pre-load users
loadUsers();

// expose closePopup to global
window.closePopup = closePopup;
window.showImagePopup = showImagePopup;
window.editAccount = editAccount;
window.deleteAccount = deleteAccount;
window.toggleStatus = toggleStatus;
</script>
</body>
</html>k
